---
  import "@fontsource/source-serif-4/400.css";
  import "@fontsource/source-serif-4/500.css";
  import "@fontsource/source-serif-4/600.css";
  import "@fontsource/inter-tight/400.css";
  import "@fontsource/inter-tight/500.css";
  import "@fontsource/inter-tight/600.css";
  import { ClientRouter } from "astro:transitions";
  import Footer from "../components/Footer.astro";
  import ThemeToggle from "../components/ThemeToggle.astro";
  import "../styles/global.css";

  type Props = {
    title: string;
  };

  const { title } = Astro.props;
  const currentPath = Astro.url.pathname;

  const navItems = [
    { label: "About", href: "/about-me" },
    { label: "Blog", href: "/blog" },
    { label: "Photos", href: "/photos" },
    { label: "Contact", href: "/contact" },
  ];

  const isActive = (href: string) => {
    if (href === "/") return currentPath === "/";
    return currentPath.startsWith(href);
  };
---
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{title}</title>

    <script is:inline>
      const theme = localStorage.getItem("theme") || "system";

      function shouldUseDarkMode(themeValue) {
        if (themeValue === "dark") return true;
        if (themeValue === "light") return false;
        return window.matchMedia("(prefers-color-scheme: dark)").matches;
      }

      if (shouldUseDarkMode(theme)) {
        document.documentElement.classList.add("dark");
      }

      document.addEventListener("astro:before-swap", (e) => {
        const savedTheme = localStorage.getItem("theme") || "system";
        if (shouldUseDarkMode(savedTheme)) {
          e.newDocument.documentElement.classList.add("dark");
        } else {
          e.newDocument.documentElement.classList.remove("dark");
        }
      });
    </script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="/android-icon-192x192.png"
    >
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#faf8f5">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#faf8f5">
    <ClientRouter/>
  </head>
  <body
    class="flex flex-col bg-paper dark:bg-paper_dark text-ink-700 dark:text-ink_dark-200 min-h-screen transition-colors duration-300"
  >
    <!-- Site Header -->
    <header
      class="sticky top-0 z-40 bg-paper/95 dark:bg-paper_dark/95 backdrop-blur-sm border-b border-border/30 dark:border-border-dark/30 transition-colors duration-300"
    >
      <div class="max-w-2xl mx-auto px-6 py-4">
        <div class="flex items-center justify-between">
          <!-- Site Title -->
          <a
            href="/"
            class="text-lg font-medium text-ink dark:text-ink_dark hover:text-accent dark:hover:text-accent_dark transition-colors duration-300 font-sans"
          >
            Nikita Fordui
          </a>

          <!-- Navigation -->
          <nav class="hidden sm:flex items-center gap-6 font-sans text-sm">
            {navItems.map((item) => (
              <a
                href={item.href}
                data-astro-prefetch
                class={`transition-colors duration-300 ${
                  isActive(item.href)
                    ? "text-accent dark:text-accent_dark font-medium"
                    : "text-ink-500 dark:text-ink_dark-400 hover:text-accent dark:hover:text-accent_dark"
                }`}
              >
                {item.label}
              </a>
            ))}
            <ThemeToggle/>
          </nav>

          <!-- Mobile menu button -->
          <button
            id="mobile-menu-btn"
            class="sm:hidden p-2 -mr-2 text-ink-500 dark:text-ink_dark-400 hover:text-ink dark:hover:text-ink_dark transition-colors"
            aria-label="Toggle menu"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              />
            </svg>
          </button>
        </div>

        <!-- Mobile Navigation -->
        <nav
          id="mobile-nav"
          class="sm:hidden hidden pt-4 pb-2 border-t border-border/30 dark:border-border-dark/30 mt-4 font-sans text-sm"
        >
          <div class="flex flex-col gap-3">
            {navItems.map((item) => (
              <a
                href={item.href}
                data-astro-prefetch
                class={`py-1 transition-colors duration-300 ${
                  isActive(item.href)
                    ? "text-accent dark:text-accent_dark font-medium"
                    : "text-ink-500 dark:text-ink_dark-400"
                }`}
              >
                {item.label}
              </a>
            ))}
            <div class="pt-2">
              <ThemeToggle/>
            </div>
          </div>
        </nav>
      </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow max-w-2xl mx-auto px-6 py-12 md:py-20 w-full">
      <slot/>
    </main>

    <Footer/>

    <!-- Mobile Menu Script -->
    <script>
      function initMobileMenu() {
        const btn = document.getElementById("mobile-menu-btn");
        const nav = document.getElementById("mobile-nav");

        btn?.addEventListener("click", () => {
          nav?.classList.toggle("hidden");
        });
      }

      initMobileMenu();
      document.addEventListener("astro:after-swap", initMobileMenu);
    </script>
  </body>
</html>
