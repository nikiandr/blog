@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html {
    scroll-behavior: smooth;
  }

  body {
    @apply font-serif;
  }
}

@layer utilities {
  .hide-scrollbar::-webkit-scrollbar {
    display: none;
  }

  .hide-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
}

/* Prose Content Styling - Book-like reading experience */
@layer components {
  .prose {
    @apply max-w-[42rem] text-ink-700 dark:text-ink_dark-200 text-lg leading-[1.75] transition-colors duration-300;
    font-feature-settings:
      "kern" 1,
      "liga" 1,
      "calt" 1;
  }

  /* Headings - Classic serif styling */
  .prose h1 {
    @apply text-[2.5rem] font-normal text-ink dark:text-ink_dark mb-6 mt-10 leading-[1.2] first:mt-0 tracking-tight transition-colors duration-300;
    scroll-margin-top: 2rem;
  }

  .prose h2 {
    @apply text-[2rem] font-normal text-ink dark:text-ink_dark mb-5 mt-10 leading-[1.25] first:mt-0 tracking-tight transition-colors duration-300;
    scroll-margin-top: 2rem;
  }

  .prose h3 {
    @apply text-[1.5rem] font-medium text-ink dark:text-ink_dark mb-4 mt-8 leading-[1.3] first:mt-0 transition-colors duration-300;
    scroll-margin-top: 2rem;
  }

  .prose h4 {
    @apply text-[1.25rem] font-medium text-ink dark:text-ink_dark mb-3 mt-6 leading-snug first:mt-0 transition-colors duration-300;
  }

  .prose h5 {
    @apply text-lg font-semibold text-ink dark:text-ink_dark mb-3 mt-5 leading-normal first:mt-0 transition-colors duration-300;
  }

  .prose h6 {
    @apply text-base font-semibold text-ink-600 dark:text-ink_dark-300 mb-2 mt-4 leading-normal first:mt-0 uppercase tracking-wide transition-colors duration-300;
  }

  /* Paragraphs */
  .prose p {
    @apply mb-6 leading-[1.75] last:mb-0;
  }

  /* First paragraph drop cap (optional - add .drop-cap class to article) */
  .prose.drop-cap > p:first-of-type::first-letter {
    @apply float-left text-[3.5rem] font-semibold leading-[0.8] mr-2 mt-1 text-accent dark:text-accent_dark;
  }

  /* Links - Scholarly style */
  .prose a {
    @apply text-accent dark:text-accent_dark underline decoration-accent/30 dark:decoration-accent_dark/30 underline-offset-2 transition-colors duration-300;
  }

  .prose a:hover {
    @apply text-accent-light dark:text-accent_dark-light decoration-accent dark:decoration-accent_dark;
  }

  .prose a:focus {
    @apply outline-none ring-2 ring-accent/50 dark:ring-accent_dark/50 ring-offset-2 ring-offset-paper dark:ring-offset-paper_dark;
  }

  /* Lists */
  .prose ul {
    @apply mb-6 ml-6 list-disc;
  }

  .prose ol {
    @apply mb-6 ml-6 list-decimal;
  }

  .prose li {
    @apply mb-2 leading-[1.7] pl-1;
  }

  .prose ul ul,
  .prose ol ul,
  .prose ul ol,
  .prose ol ol {
    @apply mt-2 ml-6 mb-0;
  }

  .prose ol ol {
    @apply list-[lower-alpha];
  }

  /* Code - Warm tones */
  .prose code {
    @apply bg-paper-300 dark:bg-paper_dark-50 text-ink-700 dark:text-ink_dark-200 px-1.5 py-0.5 rounded text-[0.9em] font-mono transition-colors duration-300;
  }

  .prose pre {
    @apply bg-ink-800 dark:bg-paper_dark-500 text-ink-100 dark:text-ink_dark-200 p-5 rounded-lg mb-6 overflow-x-auto transition-colors duration-300;
  }

  .prose pre code {
    @apply bg-transparent text-inherit p-0 text-sm leading-relaxed;
  }

  /* Blockquotes - Classic book styling */
  .prose blockquote {
    @apply border-l-0 bg-transparent pl-8 pr-6 py-4 my-8 text-ink-500 dark:text-ink_dark-300 transition-colors duration-300;
    font-style: italic;
    font-size: 1.1em;
    line-height: 1.7;
  }

  .prose blockquote p {
    @apply mb-3 last:mb-0;
  }

  .prose blockquote cite {
    @apply block mt-4 text-base not-italic text-ink-400 dark:text-ink_dark-400;
  }

  .prose blockquote cite::before {
    content: "— ";
  }

  /* Tables */
  .prose table {
    @apply w-full border-collapse text-base my-8;
  }

  .prose thead {
    @apply bg-paper-200 dark:bg-paper_dark-50 border-b-2 border-border dark:border-border-dark transition-colors duration-300;
  }

  .prose th {
    @apply px-4 py-3 text-left font-semibold text-ink dark:text-ink_dark transition-colors duration-300;
  }

  .prose tbody tr {
    @apply border-b border-border/60 dark:border-border-dark/60 transition-colors duration-300;
  }

  .prose tbody tr:hover {
    @apply bg-paper-200/50 dark:bg-paper_dark-50/50;
  }

  .prose td {
    @apply px-4 py-3 text-ink-600 dark:text-ink_dark-300 transition-colors duration-300;
  }

  /* Horizontal Rules */
  .prose hr {
    @apply my-12 border-t border-border dark:border-border-dark transition-colors duration-300;
  }

  /* Images */
  .prose img {
    @apply my-8 rounded-lg w-full h-auto;
  }

  /* Strong/Bold */
  .prose strong {
    @apply font-semibold text-ink dark:text-ink_dark transition-colors duration-300;
  }

  /* Emphasis/Italic */
  .prose em {
    @apply italic;
  }

  /* Figures with captions */
  .prose figure {
    @apply my-8;
  }

  .prose figcaption {
    @apply text-center text-sm text-ink-400 dark:text-ink_dark-400 mt-3 italic;
  }

  /* Definition lists */
  .prose dl {
    @apply my-6;
  }

  .prose dt {
    @apply font-semibold text-ink dark:text-ink_dark mt-4 first:mt-0;
  }

  .prose dd {
    @apply ml-6 mt-1 text-ink-600 dark:text-ink_dark-300;
  }

  /* Small text */
  .prose small {
    @apply text-sm text-ink-500 dark:text-ink_dark-400;
  }

  /* Inline elements spacing */
  .prose > * + * {
    @apply mt-0;
  }
}

/* Sidenote System - Gwern-style */
@layer components {
  /* Counter for sidenotes */
  .prose {
    counter-reset: sidenote-counter;
  }

  .sidenote-wrapper {
    @apply relative;
  }

  /* Sidenote reference number */
  .sidenote-number {
    counter-increment: sidenote-counter;
  }

  .sidenote-number::after {
    content: counter(sidenote-counter);
    @apply text-xs text-accent dark:text-accent_dark align-super ml-0.5 cursor-pointer;
  }

  /* Checkbox for mobile toggle (hidden) */
  .sidenote-checkbox {
    @apply hidden;
  }

  /* The sidenote itself */
  .sidenote {
    @apply text-sm text-ink-500 dark:text-ink_dark-400 leading-relaxed transition-all duration-300;
  }

  .sidenote::before {
    content: counter(sidenote-counter) ". ";
    @apply font-semibold text-accent dark:text-accent_dark;
  }

  /* Desktop: Float to right margin */
  @media (min-width: 1280px) {
    .sidenote {
      @apply float-right clear-right relative w-[220px] mr-[-260px] mt-0 mb-4 pl-4 border-l border-border/40 dark:border-border-dark/40;
    }
  }

  /* Mobile: Inline collapsible */
  @media (max-width: 1279px) {
    .sidenote {
      @apply hidden bg-paper-200 dark:bg-paper_dark-50 p-4 rounded-lg my-4 mx-0;
    }

    .sidenote-checkbox:checked + .sidenote {
      @apply block;
    }

    .sidenote-number {
      @apply cursor-pointer;
    }

    .sidenote-number:hover::after {
      @apply text-accent-light dark:text-accent_dark-light;
    }
  }

  /* Margin note (unnumbered) */
  .marginnote {
    @apply text-sm text-ink-500 dark:text-ink_dark-400 leading-relaxed;
  }

  @media (min-width: 1280px) {
    .marginnote {
      @apply float-right clear-right relative w-[220px] mr-[-260px] mt-0 mb-4 pl-4 border-l border-border/40 dark:border-border-dark/40;
    }
  }

  @media (max-width: 1279px) {
    .marginnote {
      @apply bg-paper-200 dark:bg-paper_dark-50 p-4 rounded-lg my-4;
    }
  }
}

/* Reading progress indicator */
@layer components {
  .reading-progress {
    @apply fixed top-0 left-0 h-[3px] bg-accent dark:bg-accent_dark z-50 transition-all duration-75;
    width: 0%;
  }
}

/* External link icons - Gwern-style */
@layer components {
  .prose a[href^="http"]:not([href*="nfordui.com"])::after {
    content: "↗";
    @apply text-[0.7em] ml-0.5 opacity-50 inline-block;
  }

  .prose a[href^="http"]:not([href*="nfordui.com"]):hover::after {
    @apply opacity-100;
  }
}

/* Epigraph - Tufte-style opening quote */
@layer components {
  .epigraph {
    @apply my-10 pl-0 pr-0;
  }

  .epigraph blockquote {
    @apply text-xl italic text-ink-600 dark:text-ink_dark-300 pl-0 pr-0 py-0 my-0 border-none leading-relaxed;
  }

  .epigraph blockquote p {
    @apply mb-0;
  }

  .epigraph footer,
  .epigraph cite {
    @apply block text-base not-italic text-ink-400 dark:text-ink_dark-500 mt-3;
  }

  .epigraph footer::before,
  .epigraph cite::before {
    content: "— ";
  }

  /* Multiple epigraphs */
  .epigraph + .epigraph {
    @apply mt-6;
  }
}

/* Small caps utility */
@layer utilities {
  .small-caps {
    font-variant: small-caps;
    letter-spacing: 0.05em;
  }
}

/* Newthought - Tufte-style section opener */
@layer components {
  .newthought {
    @apply small-caps text-[1.1em];
  }
}
